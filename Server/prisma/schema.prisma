generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                  Int                  @id @default(autoincrement())
  email               String               @unique
  userName            String               @unique
  phoneNo             Int?
  address             String?
  smartAddress        String               @unique
  profileImageUrl     String?
  hashedPassphrase    String
  hashedPrivkey       String
  location            String?
  emailNotify         Boolean              @default(true)
  expoPushToken       String?
  pushNotify          Boolean              @default(false)
  createdChamas       Chama[]              @relation("AdminChamas")
  chamas              ChamaMember[]
  joinRequests        ChamaRequest[]
  messages            Message[]
  notifications       Notification[]
  payOuts             PayOut[]
  payments            Payment[]
  pretiumTransactions PretiumTransaction[]
}

model Chama {
  id            Int            @id @default(autoincrement())
  name          String
  slug          String         @unique
  description   String?
  adminTerms    String?
  type          String
  startDate     DateTime
  payDate       DateTime
  cycleTime     Int
  started       Boolean        @default(false)
  amount        String
  round         Int            @default(1)
  cycle         Int            @default(1)
  maxNo         Int            @default(15)
  rating        Int            @default(0)
  raterCount    Int            @default(0)
  blockchainId  String
  adminId       Int
  canJoin       Boolean        @default(true)
  payOutOrder   String?
  createdAt     DateTime       @default(now())
  admin         User           @relation("AdminChamas", fields: [adminId], references: [id])
  members       ChamaMember[]
  requests      ChamaRequest[]
  messages      Message[]
  notifications Notification[]
  payOuts       PayOut[]
  payments      Payment[]
  roundOutcome  roundOutcome[]
}

model ChamaMember {
  id           Int      @id @default(autoincrement())
  userId       Int
  chamaId      Int
  payDate      DateTime
  lastReadTime DateTime @default(now())
  chama        Chama    @relation(fields: [chamaId], references: [id])
  user         User     @relation(fields: [userId], references: [id])
}

model Payment {
  id          Int      @id @default(autoincrement())
  amount      String
  description String?
  doneAt      DateTime @default(now())
  txHash      String
  userId      Int
  chamaId     Int?
  sender      String?
  receiver    String?
  chama       Chama?   @relation(fields: [chamaId], references: [id])
  user        User     @relation(fields: [userId], references: [id])
}

model Notification {
  id         Int      @id @default(autoincrement())
  message    String
  senderId   Int?
  requestId  Int?
  userId     Int
  chamaId    Int?
  read       Boolean  @default(false)
  createdAt  DateTime @default(now())
  type       String?
  sharedLink String?
  chama      Chama?   @relation(fields: [chamaId], references: [id])
  user       User     @relation(fields: [userId], references: [id])
}

model ChamaRequest {
  id        Int      @id @default(autoincrement())
  status    String   @default("pending")
  createdAt DateTime @default(now())
  userId    Int
  chamaId   Int
  chama     Chama    @relation(fields: [chamaId], references: [id])
  user      User     @relation(fields: [userId], references: [id])
}

model Message {
  id        Int      @id @default(autoincrement())
  chamaId   Int
  senderId  Int
  text      String
  timestamp DateTime @default(now())
  chama     Chama    @relation(fields: [chamaId], references: [id])
  sender    User     @relation(fields: [senderId], references: [id])
}

model PayOut {
  id       Int      @id @default(autoincrement())
  amount   String
  doneAt   DateTime @default(now())
  txHash   String?
  receiver String
  userId   Int
  chamaId  Int
  chama    Chama    @relation(fields: [chamaId], references: [id])
  user     User     @relation(fields: [userId], references: [id])
}

model roundOutcome {
  id           Int      @id @default(autoincrement())
  disburse     Boolean
  chamaCycle   Int
  chamaRound   Int
  amountPaid   String
  shownMembers String?
  createdAt    DateTime @default(now())
  chamaId      Int
  chama        Chama    @relation(fields: [chamaId], references: [id])
}

model PretiumTransaction {
  id               Int      @id @default(autoincrement())
  userId           Int
  transactionCode  String   @unique
  isOnramp         Boolean
  pretiumType      String?
  shortcode        String?
  account_number   String?
  amount           Decimal  @db.Decimal(10, 2)
  type             String   @default("payment")
  status           String   @default("pending")
  receiptNumber    String?
  transactionDate  String?
  isRealesed       Boolean
  message          String?
  chamaId          Int?
  cusdAmount       Decimal? @db.Decimal(18, 6)
  exchangeRate     Decimal? @db.Decimal(10, 2)
  walletAddress    String?
  blockchainTxHash String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  user             User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([transactionCode])
  @@index([status])
  @@index([type])
  @@index([createdAt])
}
